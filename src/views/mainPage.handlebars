<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <title>Vertika - Explora Experiencias</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    body {
      font-family: 'Arial', sans-serif;
      margin: 0;
      padding: 0;
      background: #f4f6f8;
      color: #333;
    }

    header {
      background: #ffffff;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      padding: 15px 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 10;
    }

    header .logo {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    header .logo img {
      height: 50px;
    }

    header .logo h1 {
      font-size: 24px;
      margin: 0;
      color: #2c3e50;
      cursor: pointer;
    }

    nav {
      display: flex;
      align-items: center;
      gap: 25px;
    }

    nav a {
      text-decoration: none;
      color: #2c3e50;
      font-weight: 600;
      padding: 8px 16px;
      border-radius: 20px;
      transition: all 0.3s;
    }

    nav a:hover {
      background: #f0f0f0;
      color: #667eea;
    }

    nav a.active {
      background: #667eea;
      color: white;
    }

    header .user-actions {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    header .user-actions button {
      padding: 8px 16px;
      border-radius: 25px;
      border: none;
      cursor: pointer;
      font-weight: bold;
      transition: background 0.3s;
    }

    header .user-actions button.login {
      background: #667eea;
      color: white;
    }

    header .user-actions button.login:hover {
      background: #5a67d8;
    }

    header .user-actions button.register {
      background: #764ba2;
      color: white;
    }

    header .user-actions button.register:hover {
      background: #613abf;
    }

    header .user-actions .username {
      font-weight: bold;
      color: #2c3e50;
    }

    header .user-actions button.logout {
      background: #e74c3c;
      color: white;
    }

    header .user-actions button.logout:hover {
      background: #c0392b;
    }

    .hero {
      text-align: center;
      padding: 60px 20px 30px;
      background: linear-gradient(to right, #1e3c72 0%, #2a5298 100%);
      color: white;
    }

    .hero h2 {
      font-size: 36px;
      margin-bottom: 10px;
    }

    .hero p {
      font-size: 18px;
      margin: 0;
    }

    .search-container {
      margin-top: 30px;
      display: flex;
      justify-content: center;
    }

    .search-container input {
      width: 50%;
      padding: 12px 20px;
      border-radius: 50px;
      border: none;
      font-size: 16px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      transition: box-shadow 0.3s;
    }

    .search-container input:focus {
      outline: none;
      box-shadow: 0 4px 20px rgba(102, 126, 234, 0.4);
    }

    main {
      max-width: 1200px;
      margin: 40px auto;
      padding: 0 20px;
    }

    /*Experiencias card*/
    /* Grid para las tarjetas */
#experiencesContainer {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 24px;
    padding: 20px 0;
}

/* Tarjeta */
.experience-card {
    background: white;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    transition: transform 0.2s, box-shadow 0.2s;
    cursor: pointer;
    display: flex;
    flex-direction: column;
}

.experience-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 12px 20px rgba(0,0,0,0.1);
}

/* Imagen */
.card-image-wrapper {
    position: relative;
    height: 180px;
    overflow: hidden;
}

.card-image-wrapper img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.card-badge {
    position: absolute;
    top: 10px;
    left: 10px;
    background: rgba(0,0,0,0.6);
    color: white;
    padding: 4px 8px;
    font-size: 0.75rem;
    border-radius: 4px;
    text-transform: uppercase;
}

/* Contenido */
.content {
    padding: 16px;
    display: flex;
    flex-direction: column;
    gap: 6px;
}

.card-header {
    display: flex;
    justify-content: space-between;
    align-items: start;
}

.content h3 {
    margin: 0;
    font-size: 1rem;
    font-weight: 700;
    color: #222;
}

.location {
    color: #777;
    font-size: 0.9rem;
    margin: 0;
}

.date {
    color: #555;
    font-size: 0.85rem;
    margin: 4px 0;
}

.price-row {
    margin-top: auto; /* Empuja el precio al fondo */
    padding-top: 10px;
    display: flex;
    align-items: baseline;
    gap: 4px;
}

.price strong {
    font-size: 1.1rem;
    color: #222;
}
/*Experiencias*/



    @media (max-width: 768px) {
      .search-container input {
        width: 80%;
      }
    }

    @media (max-width: 480px) {
      header {
        flex-direction: column;
        gap: 10px;
      }

      header .user-actions {
        flex-wrap: wrap;
        justify-content: center;
      }
    }

    /* Estilos del Modal */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0, 0, 0, 0.6);
      animation: fadeIn 0.3s;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }

      to {
        opacity: 1;
      }
    }

    .modal-content {
      background-color: #fefefe;
      margin: 5% auto;
      padding: 30px;
      border-radius: 15px;
      width: 90%;
      max-width: 600px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
      animation: slideDown 0.3s;
    }

    @keyframes slideDown {
      from {
        transform: translateY(-50px);
        opacity: 0;
      }

      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
      border-bottom: 2px solid #f0f0f0;
      padding-bottom: 15px;
    }

    .modal-header h2 {
      margin: 0;
      color: #2c3e50;
      font-size: 24px;
    }

    .close {
      color: #aaa;
      font-size: 32px;
      font-weight: bold;
      cursor: pointer;
      transition: color 0.2s;
      line-height: 1;
    }

    .close:hover,
    .close:focus {
      color: #667eea;
    }

    .modal-body {
      margin-bottom: 20px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      color: #2c3e50;
      font-weight: 600;
      font-size: 14px;
    }

    .form-group input,
    .form-group textarea,
    .form-group select {
      width: 100%;
      padding: 12px 15px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 14px;
      transition: border-color 0.3s;
      box-sizing: border-box;
    }

    .form-group input:focus,
    .form-group textarea:focus,
    .form-group select:focus {
      outline: none;
      border-color: #667eea;
    }

    .form-group textarea {
      resize: vertical;
      min-height: 100px;
      font-family: 'Arial', sans-serif;
    }

    .form-group small {
      display: block;
      margin-top: 5px;
      color: #666;
      font-size: 12px;
    }

    .language-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 10px;
    }

    .language-tag {
      background: #667eea;
      color: white;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 13px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .language-tag .remove-tag {
      cursor: pointer;
      font-weight: bold;
      font-size: 16px;
    }

    .add-item-container {
      display: flex;
      gap: 10px;
    }

    .add-item-container input {
      flex: 1;
    }

    .add-item-container button {
      padding: 12px 20px;
      background: #667eea;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: background 0.3s;
    }

    .add-item-container button:hover {
      background: #5a67d8;
    }

    .modal-footer {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      padding-top: 20px;
      border-top: 2px solid #f0f0f0;
    }

    .modal-footer button {
      padding: 12px 30px;
      border: none;
      border-radius: 25px;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      transition: all 0.3s;
    }

    .btn-cancel {
      background: #f0f0f0;
      color: #666;
    }

    .btn-cancel:hover {
      background: #e0e0e0;
    }

    .btn-submit {
      background: linear-gradient(to right, #667eea, #764ba2);
      color: white;
    }

    .btn-submit:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }

    .specialty-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 10px;
    }

    .specialty-tag {
      background: #764ba2;
      color: white;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 13px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .specialty-tag .remove-tag {
      cursor: pointer;
      font-weight: bold;
      font-size: 16px;
    }

    /* Modal de Detalle de Experiencia */
    .experience-modal {
      display: none;
      position: fixed;
      z-index: 2000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0, 0, 0, 0.7);
      animation: fadeIn 0.3s;
    }

    .experience-modal-content {
      background-color: #fefefe;
      margin: 2% auto;
      padding: 0;
      border-radius: 15px;
      width: 90%;
      max-width: 900px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
      animation: slideDown 0.3s;
      max-height: 90vh;
      overflow-y: auto;
    }

    .experience-modal-header {
      position: relative;
      height: 400px;
      overflow: hidden;
      border-radius: 15px 15px 0 0;
    }

    .experience-modal-header img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .experience-modal-close {
      position: absolute;
      top: 15px;
      right: 20px;
      color: white;
      font-size: 40px;
      font-weight: bold;
      cursor: pointer;
      background: rgba(0, 0, 0, 0.5);
      width: 45px;
      height: 45px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.3s;
      z-index: 10;
      line-height: 1;
    }

    .experience-modal-close:hover {
      background: rgba(0, 0, 0, 0.8);
    }

    .experience-modal-body {
      padding: 30px;
    }

    .experience-modal-title {
      font-size: 32px;
      color: #2c3e50;
      margin: 0 0 20px;
      font-weight: bold;
    }

    .experience-badges {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 20px;
    }

    .experience-badge {
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 600;
      display: inline-block;
    }

    .badge-activity {
      background: #667eea;
      color: white;
    }

    .badge-difficulty {
      background: #764ba2;
      color: white;
    }

    .badge-status {
      background: #48bb78;
      color: white;
    }

    .experience-info-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin: 30px 0;
      padding: 20px;
      background: #f8f9fa;
      border-radius: 10px;
    }

    .experience-info-item {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }

    .experience-info-label {
      font-size: 12px;
      color: #666;
      text-transform: uppercase;
      font-weight: 600;
      letter-spacing: 0.5px;
    }

    .experience-info-value {
      font-size: 18px;
      color: #2c3e50;
      font-weight: bold;
    }

    .experience-description {
      margin: 30px 0;
      line-height: 1.8;
      color: #555;
      font-size: 16px;
    }

    .experience-photos-gallery {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 10px;
      margin: 20px 0;
    }

    .experience-photos-gallery img {
      width: 100%;
      height: 150px;
      object-fit: cover;
      border-radius: 8px;
      cursor: pointer;
      transition: transform 0.3s;
    }

    .experience-photos-gallery img:hover {
      transform: scale(1.05);
    }

    .experience-modal-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 25px 30px;
      border-top: 2px solid #f0f0f0;
      background: #fafafa;
      border-radius: 0 0 15px 15px;
    }

    .experience-price {
      font-size: 28px;
      color: #2c3e50;
      font-weight: bold;
    }

    .experience-price-label {
      font-size: 14px;
      color: #666;
      font-weight: normal;
    }

    .btn-reserve {
      padding: 15px 40px;
      background: linear-gradient(to right, #667eea, #764ba2);
      color: white;
      border: none;
      border-radius: 30px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
    }

    .btn-reserve:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
    }

    @media (max-width: 768px) {
      .experience-modal-content {
        width: 95%;
        margin: 5% auto;
      }

      .experience-modal-header {
        height: 250px;
      }

      .experience-modal-title {
        font-size: 24px;
      }

      .experience-info-grid {
        grid-template-columns: 1fr;
      }

      .experience-modal-footer {
        flex-direction: column;
        gap: 15px;
      }
    }


    /* Estilos para Reviews del Guía */
    .guide-reviews-section {
      margin-top: 40px;
      padding-top: 30px;
      border-top: 2px solid #f0f0f0;
    }

    .guide-reviews-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
    }

    .guide-reviews-title {
      font-size: 24px;
      color: #2c3e50;
      font-weight: bold;
      margin: 0;
    }

    .guide-rating-summary {
      display: flex;
      align-items: center;
      gap: 15px;
      background: #f8f9fa;
      padding: 15px 25px;
      border-radius: 10px;
    }

    .guide-rating-number {
      font-size: 36px;
      font-weight: bold;
      color: #667eea;
    }

    .guide-rating-stars {
      display: flex;
      gap: 4px;
      font-size: 24px;
    }

    .guide-rating-stars .star-filled {
      color: #ffd700;
    }

    .guide-rating-stars .star-empty {
      color: #ddd;
    }

    .guide-rating-count {
      font-size: 14px;
      color: #666;
    }

    .reviews-list {
      display: flex;
      flex-direction: column;
      gap: 20px;
      max-height: 500px;
      overflow-y: auto;
      padding-right: 10px;
    }

    .review-card {
      background: #ffffff;
      border: 1px solid #e0e0e0;
      border-radius: 12px;
      padding: 20px;
      transition: box-shadow 0.3s;
    }

    .review-card:hover {
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .review-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 12px;
    }

    .review-user-info {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }

    .review-user-name {
      font-weight: 600;
      color: #2c3e50;
      font-size: 16px;
    }

    .review-date {
      font-size: 12px;
      color: #999;
    }

    .review-ratings {
      display: flex;
      flex-direction: column;
      gap: 5px;
      align-items: flex-end;
    }

    .review-rating-item {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 12px;
      color: #666;
    }

    .review-stars {
      display: flex;
      gap: 2px;
      font-size: 14px;
    }

    .review-stars .star-filled {
      color: #ffd700;
    }

    .review-stars .star-empty {
      color: #ddd;
    }

    .review-comment {
      color: #555;
      line-height: 1.6;
      margin: 12px 0;
      font-size: 14px;
    }

    .review-photos {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-top: 12px;
    }

    .review-photo {
      width: 80px;
      height: 80px;
      border-radius: 8px;
      object-fit: cover;
      cursor: pointer;
      transition: transform 0.3s;
    }

    .review-photo:hover {
      transform: scale(1.1);
    }

    .no-reviews {
      text-align: center;
      padding: 40px;
      color: #999;
      font-size: 16px;
    }

    .reviews-loading {
      text-align: center;
      padding: 40px;
      color: #667eea;
      font-size: 16px;
    }

    /* Modal de Reserva */
    .reservation-modal {
      display: none;
      position: fixed;
      z-index: 3000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0, 0, 0, 0.7);
      animation: fadeIn 0.3s;
    }

    .reservation-modal-content {
      background-color: #fefefe;
      margin: 5% auto;
      padding: 30px;
      border-radius: 15px;
      width: 90%;
      max-width: 500px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
      animation: slideDown 0.3s;
    }

    .reservation-modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
      border-bottom: 2px solid #f0f0f0;
      padding-bottom: 15px;
    }

    .reservation-modal-header h2 {
      margin: 0;
      color: #2c3e50;
      font-size: 24px;
    }

    .reservation-summary {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 25px;
    }

    .reservation-summary-title {
      font-size: 18px;
      color: #2c3e50;
      font-weight: bold;
      margin-bottom: 10px;
    }

    .reservation-summary-item {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      color: #555;
      font-size: 14px;
    }

    .reservation-summary-total {
      display: flex;
      justify-content: space-between;
      padding: 15px 0;
      border-top: 2px solid #ddd;
      margin-top: 10px;
      font-weight: bold;
      font-size: 18px;
      color: #2c3e50;
    }

    .seats-selector {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 20px;
      margin: 20px 0;
    }

    .seats-btn {
      width: 45px;
      height: 45px;
      border-radius: 50%;
      border: 2px solid #667eea;
      background: white;
      color: #667eea;
      font-size: 24px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .seats-btn:hover:not(:disabled) {
      background: #667eea;
      color: white;
      transform: scale(1.1);
    }

    .seats-btn:disabled {
      opacity: 0.3;
      cursor: not-allowed;
    }

    .seats-display {
      font-size: 32px;
      font-weight: bold;
      color: #2c3e50;
      min-width: 60px;
      text-align: center;
    }

    .seats-label {
      text-align: center;
      color: #666;
      font-size: 14px;
      margin-top: 10px;
    }

    .reservation-modal-footer {
      display: flex;
      gap: 10px;
      padding-top: 20px;
      border-top: 2px solid #f0f0f0;
    }

    .reservation-modal-footer button {
      flex: 1;
      padding: 15px;
      border: none;
      border-radius: 25px;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      transition: all 0.3s;
    }

    .btn-cancel-reservation {
      background: #f0f0f0;
      color: #666;
    }

    .btn-cancel-reservation:hover {
      background: #e0e0e0;
    }

    .btn-confirm-reservation {
      background: linear-gradient(to right, #667eea, #764ba2);
      color: white;
    }

    .btn-confirm-reservation:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }

    .reservation-alert {
      background: #fff3cd;
      border: 1px solid #ffc107;
      color: #856404;
      padding: 12px 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      font-size: 14px;
    }


/* NOTIFICACIONES*/
   .notif-modal {
  position: fixed;
  z-index: 1000;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  overflow: auto;
  background-color: rgba(0,0,0,0.8);
}

.notif-modal-content {
  background-color: #ffffff; /* gris claro */
  margin: 5% auto;
  padding: 20px;
  width: 400px;
  border-radius: 10px;
  display: flex;
  flex-direction: column;
  gap: 10px;
}

/* Quitar los bullets de lista */
#notificationsList {
  list-style: none;
  padding: 0;
  margin: 0;
}

/* Cada notificación como un rectángulo */
#notificationsList li {
  background-color: #f0f0f0; /* gris claro */
  margin-bottom: 8px;
  padding: 12px 16px;
  border-radius: 6px;
  cursor: pointer;
  transition: background-color 0.2s ease;
}

/* Hover para iluminar */
#notificationsList li:hover {
  background-color: #e0e0e0;
}

@keyframes blinkAnimation {
  0%, 100% { color: #c62828; }
  50% { color: #000000; }
}

.blink i {
  animation: blinkAnimation 1s infinite;
}
.notif-icon {
  position: relative; /* necesario para la bolita */
  display: inline-block;
  font-size: 1.2rem;
}
.notif-icon:hover {
  font-size: 1.25rem;
  color: #706f6f;
}

.notif-badge {
  position: absolute;
  top: 0px;
  right: 0px;
  width: 10px;
  height: 10px;
  background-color: red;
  border-radius: 50%;
  pointer-events: none;
}
.notif-icon-container {
  position: relative; /* Necesario para posicionar la bolita */
}

/* El círculo azul */
.unread-dot {
  height: 10px;
  width: 10px;
  background-color: #007bff; /* Azul */
  border-radius: 100%;
  display: inline-block;
  margin-right: 8px;
}

/* Estilo para el item de la lista no leído (opcional, negrita) */
.notif-item.unread {
  font-weight: 600;
  background-color: #f9f9f9;
}

/* Contenedor del usuario (Texto + Avatar) */
.user-menu-container {
    display: flex;
    align-items: center;
    gap: 10px;
    cursor: pointer;
    position: relative; /* Necesario para el dropdown */
    padding: 5px;
    border-radius: 8px;
    transition: background 0.2s;
}
.user-menu-container:hover {
    background-color: #f0f0f0;
}

/* Texto "Hola, Nombre" */
.user-greeting {
    font-weight: 500;
    font-size: 0.95rem;
    color: #333;
}

/* Avatar Imagen */
.nav-avatar {
    width: 2.5rem;
    height: 2.5rem;
    border-radius: 50%;
    object-fit: cover;
    border: 0px solid #ddd;
}

/* Menú Dropdown */
.dropdown-menu {
    display: none; /* Oculto por defecto */
    position: absolute;
    top: 100%; /* Justo debajo del contenedor */
    right: 0;
    background-color: white;
    min-width: 200px;
    box-shadow: 0 8px 16px rgba(0,0,0,0.15);
    border-radius: 8px;
    z-index: 1000;
    overflow: hidden;
    margin-top: 10px;
}

.dropdown-menu a {
    color: #333;
    padding: 12px 16px;
    text-decoration: none;
    display: block;
    font-size: 0.9rem;
    transition: background 0.2s;
}

.dropdown-menu a:hover {
    background-color: #f1f1f1;
}

/* Separador en el menú */
.dropdown-divider {
    height: 1px;
    background-color: #eee;
    margin: 4px 0;
}
/* Estilo específico para el botón de Cerrar Sesión */
#dropdownLogout {
    background-color: #e74c3c; /* Rojo */
    color: white !important;   /* Texto Blanco */
    font-weight: 600;
    margin-top: 5px;           /* Un poco de separación arriba */
}

/* Efecto al pasar el mouse (Rojo más oscuro) */
#dropdownLogout:hover {
    background-color: #c0392b; 
    color: white;
}

/*Barra busqueda*/
.form-control {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 8px;
        margin-top: 5px;
        font-size: 14px;
    }
  /* Contenedor principal para centrar */
.search-bar-wrapper {
  display: flex;
  justify-content: center;
  padding: 20px;
  width: 100%;
}

/* La barra en sí (La "píldora") */
.search-bar {
  display: flex;
  align-items: center;
  background: white;
  border-radius: 50px; /* Bordes muy redondos */
  padding: 8px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.1); /* Sombra suave */
  border: 1px solid #e0e0e0;
  max-width: 900px;
  width: 100%;
  transition: box-shadow 0.3s ease;
}

.search-bar:hover {
  box-shadow: 0 6px 24px rgba(0,0,0,0.15);
}

/* Cada sección de input */
.search-field {
  flex: 1;
  padding: 5px 15px;
  position: relative;
  display: flex;
  flex-direction: column;
  justify-content: center;
  border-radius: 30px;
  transition: background 0.2s;
}

.search-field:hover {
  background-color: #f7f7f7; /* Efecto hover sutil en cada campo */
}

/* Campo pequeño para personas */
.search-field.small-field {
  flex: 0.6; 
}

/* Divisores verticales */
.divider {
  width: 1px;
  height: 30px;
  background-color: #ddd;
  margin: 0 5px;
}

/* Etiquetas e Iconos */
.label-icon {
  display: flex;
  align-items: center;
  gap: 6px;
  margin-bottom: 2px;
}

.label-icon i {
  font-size: 0.8rem;
  color: var(--accent1, #667eea); /* Usa tu color de acento */
}

.label-icon label {
  font-size: 0.75rem;
  font-weight: 800;
  color: #333;
  cursor: pointer;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

/* Inputs y Selects limpios */
.search-bar input, 
.search-bar select {
  border: none;
  background: transparent;
  width: 100%;
  font-size: 0.95rem;
  color: #555;
  padding: 0;
  outline: none; /* Quita el borde azul al hacer click */
  font-family: inherit;
  cursor: pointer;
  text-overflow: ellipsis;
}

.search-bar input::placeholder {
  color: #aaa;
}

/* Botón de Buscar */
.search-btn {
  background: linear-gradient(135deg, var(--accent1, #667eea), var(--accent2, #764ba2));
  color: white;
  border: none;
  border-radius: 50px;
  padding: 12px 24px;
  font-size: 1rem;
  font-weight: 600;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 8px;
  margin-left: 10px;
  transition: transform 0.2s, box-shadow 0.2s;
  flex-shrink: 0; /* Evita que se aplaste */
}

.search-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
}

/* Responsive: En móviles se apilan */
@media (max-width: 850px) {
  .search-bar {
    flex-direction: column;
    border-radius: 20px;
    padding: 15px;
    gap: 10px;
  }
  
  .divider { display: none; }
  
  .search-field {
    width: 100%;
    border-bottom: 1px solid #eee;
    border-radius: 8px;
    padding: 10px;
  }
  
  .search-btn {
    width: 100%;
    justify-content: center;
    margin-left: 0;
    margin-top: 10px;
  }
}

/* Botón de Borrar Filtros */
.clear-btn {
  background: #f0f2f5;
  color: #777;
  border: none;
  width: 40px;
  height: 40px;
  border-radius: 50%; /* Círculo perfecto */
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  margin-left: 10px; /* Separación del input anterior */
  transition: all 0.2s ease;
  flex-shrink: 0;
}

.clear-btn:hover {
  background: #ffebee; /* Rojo muy suave de fondo */
  color: #e74c3c;      /* Icono rojo */
  transform: rotate(-15deg); /* Pequeña animación divertida */
}

/* Ajuste Responsive */
@media (max-width: 850px) {
  .clear-btn {
    width: 100%;
    border-radius: 8px; /* En móvil se hace rectangular */
    margin-left: 0;
    margin-top: 5px;
    background: #fff0f0;
    color: #e74c3c;
  }
}
  </style>
</head>

<body>
  <header>
    <div class="logo">
      <img src="https://imgur.com/2R9vMFY.png" onclick="window.location.href='/api'" alt="Vertika Logo" class="app-logo">
      <h1 onclick="window.location.href='/api'">VERTIKA</h1>
    </div>

    <nav id="mainNav" style="display: none;">
      <a href="/api" class="nav-link" data-page="home">Inicio</a>
      <a href="#" class="nav-link" data-page="reservations" id="navReservations">Mis Reservaciones</a>
      <a href="#" class="nav-link" data-page="experiences" id="navExperiences" style="display: none;">Mis
        Experiencias</a>
      <a href="#" class="nav-link" data-page="request-guide" id="navRequestGuide" style="display: none;">Solicitar ser
        Guía</a>
    </nav>

    <div class="user-actions" id="userActions">
      <button class="login" onclick="window.location.href='/api/auth/login'">Iniciar Sesión</button>
      <button class="register" onclick="window.location.href='/api/auth/register'">Registrarse</button>
    </div>
  </header>

  <section class="hero">
    <h2>Explora Experiencias en la Montaña</h2>
    <p>Encuentra, comparte y disfruta aventuras únicas.</p>
    <div class="search-bar-wrapper">
      <div class="search-bar">
        
        <div class="search-field">
          <div class="label-icon">
            <i class="fa-solid fa-location-dot"></i>
            <label for="searchInput">Destino</label>
          </div>
          <input type="text" id="searchInput" placeholder="¿A dónde vas?">
        </div>

        <div class="divider"></div>

        <div class="search-field">
          <div class="label-icon">
            <i class="fa-regular fa-calendar"></i>
            <label for="dateInput">Fecha</label>
          </div>
          <input type="date" id="dateInput">
        </div>

        <div class="divider"></div>

        <div class="search-field small-field">
          <div class="label-icon">
            <i class="fa-solid fa-user-group"></i>
            <label for="peopleInput">Personas</label>
          </div>
          <input type="number" id="peopleInput" min="1" placeholder="1">
        </div>

        <div class="divider"></div>

        <div class="search-field">
          <div class="label-icon">
            <i class="fa-solid fa-person-hiking"></i>
            <label for="activityInput">Actividad</label>
          </div>
          <select id="activityInput">
              <option value="">Cualquiera</option>
              <option value="Alpinismo">Alpinismo</option>
              <option value="Senderismo">Senderismo</option>
              <option value="Escalada">Escalada</option>
          </select>
        </div>

        <button id="btnClear" class="clear-btn" title="Borrar filtros">
        <i class="fa-solid fa-eraser"></i>
    </button>


        <button id="btnSearch" class="search-btn">
            <i class="fa-solid fa-magnifying-glass"></i>
            <span class="btn-text">Buscar</span>
        </button>

      </div>
    </div>

  </section>

  <main>
    <div class="experiences" id="experiencesContainer">
      <!-- Experiencias se cargan aquí -->
    </div>
  </main>

  <!-- Modal de Detalle de Experiencia -->
  <div id="experienceDetailModal" class="experience-modal">
    <div class="experience-modal-content">
      <div class="experience-modal-header">
        <img id="modalMainImage" src="" alt="Experiencia">
        <span class="experience-modal-close" id="closeExperienceModal">&times;</span>
      </div>

      <div class="experience-modal-body">
        <h1 class="experience-modal-title" id="modalTitle"></h1>

        <div class="experience-badges" id="modalBadges"></div>

        <div class="experience-info-grid" id="modalInfoGrid"></div>

        <div class="experience-description" id="modalDescription"></div>

        <div id="modalPhotosContainer"></div>

        <!-- Sección de Reviews del Guía -->
        <div class="guide-reviews-section">
          <div class="guide-reviews-header">
            <h3 class="guide-reviews-title">Calificaciones del Guía</h3>
            <div class="guide-rating-summary" id="guideRatingSummary">
              <div class="guide-rating-number" id="guideAvgRating">-</div>
              <div>
                <div class="guide-rating-stars" id="guideRatingStars"></div>
                <div class="guide-rating-count" id="guideReviewCount">Sin calificaciones</div>
              </div>
            </div>
          </div>
          <div id="reviewsContainer">
            <div class="reviews-loading">Cargando reseñas...</div>
          </div>
        </div>

      </div>

      <div class="experience-modal-footer">
        <div>
          <span class="experience-price" id="modalPrice"></span>
          <span class="experience-price-label"> por persona</span>
        </div>
        <button class="btn-reserve" id="btnReserve">Reservar Ahora</button>
      </div>
    </div>
  </div>

  <!-- Modal de Reserva -->
  <div id="reservationModal" class="reservation-modal">
    <div class="reservation-modal-content">
      <div class="reservation-modal-header">
        <h2>Reservar Experiencia</h2>
        <span class="close" id="closeReservationModal">&times;</span>
      </div>

      <div id="reservationAlert" class="reservation-alert" style="display: none;"></div>

      <div class="reservation-summary">
        <div class="reservation-summary-title" id="reservationExpTitle"></div>
        <div class="reservation-summary-item">
          <span>Fecha:</span>
          <span id="reservationExpDate"></span>
        </div>
        <div class="reservation-summary-item">
          <span>Ubicación:</span>
          <span id="reservationExpLocation"></span>
        </div>
        <div class="reservation-summary-item">
          <span>Precio por persona:</span>
          <span id="reservationPricePerPerson"></span>
        </div>
      </div>

      <div class="form-group">
        <label style="text-align: center; display: block; margin-bottom: 15px;">Número de personas</label>
        <div class="seats-selector">
          <button class="seats-btn" id="decreaseSeats">−</button>
          <div class="seats-display" id="seatsDisplay">1</div>
          <button class="seats-btn" id="increaseSeats">+</button>
        </div>
        <div class="seats-label" id="seatsAvailableLabel"></div>
      </div>

      <div class="reservation-summary">
        <div class="reservation-summary-total">
          <span>Total:</span>
          <span id="reservationTotal">$0.00</span>
        </div>
      </div>

      <div class="reservation-modal-footer">
        <button class="btn-cancel-reservation" id="btnCancelReservation">Cancelar</button>
        <button class="btn-confirm-reservation" id="btnConfirmReservation">Confirmar Reserva</button>
      </div>
    </div>
  </div>

<!-- Modal notificaciones-->
  <div id="notificationsModal" class="notif-modal" style="display:none;">
  <div class="notif-modal-content">
    <span class="close">&times;</span>
    <h2>Notificaciones</h2>
    <ul id="notificationsList">
      <!-- Aquí se agregarán dinámicamente las notificaciones -->
    </ul>
  </div>
</div>

  <!-- Modal para solicitar ser guía -->
  <div id="guideModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Solicitar ser Guía</h2>
        <span class="close" id="closeModal">&times;</span>
      </div>

      <div class="modal-body">
        <form id="guideForm">
          <div class="form-group">
            <label for="guideBio">Biografía *</label>
            <textarea id="guideBio" name="bio" required
              placeholder="Cuéntanos sobre ti, tu experiencia y qué te apasiona de las aventuras en la montaña..."></textarea>
            <small>Comparte tu historia y experiencia como guía</small>
          </div>

          <div class="form-group">
            <label for="guideExperienceYears">Años de Experiencia *</label>
            <input type="number" id="guideExperienceYears" name="experienceYears" min="0" max="50" required
              placeholder="0">
            <small>¿Cuántos años de experiencia tienes como guía?</small>
          </div>

          <div class="form-group">
            <label>Idiomas que hablas *</label>
            <div class="add-item-container">
              <input type="text" id="languageInput" placeholder="Ej: Español, Inglés, Francés">
              <button type="button" id="addLanguageBtn">Agregar</button>
            </div>
            <div class="language-tags" id="languageTags"></div>
            <small>Agrega los idiomas que hablas. Al menos uno es requerido.</small>
          </div>

          <div class="form-group">
            <label>Especialidades</label>
            <div class="add-item-container">
              <input type="text" id="specialtyInput" placeholder="Ej: Escalada, Senderismo, Rappel">
              <button type="button" id="addSpecialtyBtn">Agregar</button>
            </div>
            <div class="specialty-tags" id="specialtyTags"></div>
            <small>Agrega tus especialidades o áreas de expertise (opcional)</small>
          </div>
        </form>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn-cancel" id="cancelBtn">Cancelar</button>
        <button type="button" class="btn-submit" id="submitGuideBtn">Enviar Solicitud</button>
      </div>
    </div>
  </div>

  <script>
      //Funciones auxiliares notificaciones
      // --- FUNCIONES AUXILIARES ---

      // Función para actualizar la campana (Badge)
      function updateBellBadge(show) {
          const bell = document.getElementById('notifIcon');
          let badge = bell.querySelector('.notif-badge');
          
          if (show) {
              if (!badge) {
                  badge = document.createElement('span');
                  badge.classList.add('notif-badge'); // Asegúrate de tener CSS para este badge (puntito rojo)
                  bell.appendChild(badge);
              }
          } else {
              if (badge) badge.remove();
          }
      }

      // Función para crear el elemento de lista de la notificación
      function createNotificationItem(notif) {
          const li = document.createElement("li");
          li.classList.add("notif-item");
          li.style.cursor = "pointer";
          li.style.display = "flex"; // Usar flex para alinear texto y X
          li.style.justifyContent = "space-between";
          li.style.alignItems = "center";
          
          // Contenedor izquierdo (Punto azul + Texto)
          const leftContainer = document.createElement("div");
          leftContainer.style.display = "flex";
          leftContainer.style.alignItems = "center";

          // 1. Lógica del Círculo Azul (Si no está leída)
          if (!notif.read) {
              li.classList.add('unread'); 
              const dot = document.createElement("span");
              dot.classList.add("unread-dot"); 
              // Estilos inline por si faltan en CSS
              dot.style.height = "10px";
              dot.style.width = "10px";
              dot.style.backgroundColor = "#007bff";
              dot.style.borderRadius = "50%";
              dot.style.display = "inline-block";
              dot.style.marginRight = "8px";
              leftContainer.appendChild(dot);
          }

          const content = document.createElement("span");
          content.textContent = notif.message;
          leftContainer.appendChild(content);

          // 2. Botón de Eliminar (X)
          const closeBtn = document.createElement("span");
          closeBtn.innerHTML = "&times;"; // Símbolo de multiplicación (X)
          closeBtn.style.fontSize = "20px";
          closeBtn.style.color = "#999";
          closeBtn.style.marginLeft = "10px";
          closeBtn.style.padding = "0 5px";
          closeBtn.style.fontWeight = "bold";
          closeBtn.title = "Eliminar";

          // --- LOGICA DE ELIMINAR ---
          closeBtn.addEventListener('click', async (e) => {
              // IMPORTANTE: Detiene que el click llegue al LI (evita redirección)
              e.stopPropagation(); 

              // 1. Eliminación visual inmediata (UX rápida)
              li.remove();

              // 2. Verificar si quedó vacía la lista
              const list = document.getElementById('notificationsList');
              if (list && list.children.length === 0) {
                  const emptyLi = document.createElement("li");
                  emptyLi.textContent = "No tienes notificaciones";
                  list.appendChild(emptyLi);
                  updateBellBadge(false);
              } else {
                  // Re-checar si quedan no leídas para el badge
                  checkUnreadStatusInList(); 
              }

              // 3. Petición al Backend para borrar de DB
              try {
                  const token = localStorage.getItem("accessToken");
                  // Asumiendo que tienes una ruta DELETE /api/notifications/:id
                  await fetch(`/api/notifications/${notif._id}`, { 
                      method: 'DELETE',
                      headers: { 'Authorization': 'Bearer ' + token }
                  });
              } catch (err) {
                  console.error("Error eliminando notificación", err);
              }
          });

          // Agregar contenedores al LI
          li.appendChild(leftContainer);
          li.appendChild(closeBtn);

          // 2. Evento Click: Marcar como leída y navegar
          li.addEventListener('click', async (e) => {
              // Si no está leída, marcarla en el backend
              if (!notif.read) {
                  try {
                      const token = localStorage.getItem("accessToken");
                      // Llamamos al endpoint markAsRead que ya tienes en el backend
                      await fetch(`/api/notifications/${notif._id}/read`, { 
                          method: 'PATCH',
                          headers: { 'Authorization': 'Bearer ' + token }
                      });
                      
                      // Actualizar UI visualmente (quitar punto azul)
                      li.classList.remove('unread');
                      const dot = li.querySelector('.unread-dot');
                      if (dot) dot.remove();
                      notif.read = true; // Actualizar estado local

                      // Opcional: Re-checar si quedan notificaciones sin leer para quitar el badge de la campana
                      checkUnreadStatusInList(); 
                  } catch (error) {
                      console.error("Error al marcar como leída", error);
                  }
              }

              if (notif.type === 'reservation') {
                // Ajusta la URL según tus rutas de frontend
                window.location.href = `/api/experiences/view/${notif.data.experienceId}`; 
              }
          });

          return li;
      }

      // Función para revisar si quedan elementos sin leer en la lista visual actual
      function checkUnreadStatusInList() {
          const list = document.getElementById('notificationsList');
          const unreadItems = list.querySelectorAll('.notif-item.unread');
          // Si ya no hay items con clase unread, quitamos el badge de la campana
          if (unreadItems.length === 0) {
              updateBellBadge(false);
          }
      }



    // Mostrar botones según usuario logueado
    document.addEventListener('DOMContentLoaded', async () => {
      const userActions = document.getElementById('userActions');
      const mainNav = document.getElementById('mainNav');
      const navExperiences = document.getElementById('navExperiences');
      const navRequestGuide = document.getElementById('navRequestGuide');
      const navReservations = document.getElementById('navReservations');

      const user = JSON.parse(localStorage.getItem('user') || 'null');
      const token = localStorage.getItem("accessToken");

      if (!user) return;
      
        // Mostrar navbar
        mainNav.style.display = 'flex';

        // Configurar opciones según roles
        const isGuide = user.roles && user.roles.includes('guide');

        if (isGuide) {
          navExperiences.style.display = 'block';
          navRequestGuide.style.display = 'none';
        } else {
          navExperiences.style.display = 'none';
          navRequestGuide.style.display = 'block';
        }
        //Foto
        // 1. Intentamos usar la del localStorage primero
        let avatarSrc = user.avatarUrl || 'https://ttwo.dk/wp-content/uploads/2017/08/person-placeholder.jpg';

        // 2. Si no viene en localStorage, la pedimos al backend "en caliente"
        if (!user.avatarUrl) {
            try {
                // Asumo que tienes una ruta para ver datos de usuario por ID
                const res = await fetch(`/api/users/${user._id}`); // O /api/auth/profile
                if (res.ok) {
                    const userData = await res.json();
                    if (userData.avatarUrl) {
                        avatarSrc = userData.avatarUrl;
                    }
                }
            } catch (e) { console.error(e); }
        }

        // Creamos la estructura HTML con Template String
        const userMenuHTML = `
            <div class="notif-icon" id="notifIcon" style="cursor:pointer; position: relative; margin-right: 15px;">
                <i class="fa-solid fa-bell"></i>
            </div>

            <div class="user-menu-container" id="userMenuTrigger">
                <span class="user-greeting">Hola, ${user.name}</span>
                <img src="${avatarSrc}" alt="Avatar" class="nav-avatar" onerror="this.src='https://ttwo.dk/wp-content/uploads/2017/08/person-placeholder.jpg'">
                <i class="fa-solid fa-chevron-down" style="font-size: 0.8rem; color: #777; margin-left:5px;"></i>

                <div class="dropdown-menu" id="userDropdown">
                    <a href="/api/auth/profile"> Mi Perfil</a>
                    
                    <a href="#" id="dropdownGuideLink" style="display:none; color: #667eea; font-weight: 600;">
                         Mi Perfil de Guía
                    </a>

                    <div class="dropdown-divider"></div>
                    <a href="#" id="dropdownLogout"> Cerrar Sesión</a>
                </div>
            </div>
        `;

        // Inyectamos el HTML
        userActions.innerHTML = userMenuHTML;
        userActions.style.display = 'flex'; // Aseguramos que se vea

          // 4. LÓGICA DEL DROPDOWN (Abrir/Cerrar)
        const trigger = document.getElementById('userMenuTrigger');
        const dropdown = document.getElementById('userDropdown');

        trigger.addEventListener('click', (e) => {
            e.stopPropagation(); // Evitar cerrar inmediatamente
            const isVisible = dropdown.style.display === 'block';
            dropdown.style.display = isVisible ? 'none' : 'block';
        });

        // Cerrar al hacer click fuera
        document.addEventListener('click', () => {
            dropdown.style.display = 'none';
        });


            // 5. LÓGICA ESPECÍFICA DE GUÍA (Buscar ID y actualizar link)
          if (isGuide) {
              try {
                  // Hacemos fetch para obtener el ID del perfil de guía asociado a este usuario
                  const res = await fetch(`/api/guides/by-user/${user._id}`);
                  if (res.ok) {
                      const data = await res.json();
                      const guideLink = document.getElementById('dropdownGuideLink');
                      
                      if (data.guideId && guideLink) {
                          // Actualizamos el HREF y mostramos el enlace
                          guideLink.href = `/api/guides/profile/${data.guideId}`; 
                          // O si prefieres ir a editar: `/api/guides/edit/${data.guideId}`
                          guideLink.style.display = 'block';
                      }
                  }
              } catch (err) {
                  console.error("Error buscando ID de guía:", err);
              }
          }


        // Event listeners para navegación
        navReservations.addEventListener('click', (e) => {
          e.preventDefault();
          window.location.href = '/api/reservations/my-reservations';
        });

        navExperiences.addEventListener('click', (e) => {
          e.preventDefault();
          window.location.href = '/api/experiences/my-experiences';
        });

        navRequestGuide.addEventListener('click', (e) => {
          e.preventDefault();
          // Abrir el modal
          const modal = document.getElementById('guideModal');
          modal.style.display = 'block';
        });


        //Logout
        document.getElementById('dropdownLogout').addEventListener('click', async () => {
          const token = localStorage.getItem('accessToken');
          if (token) {
            try {
              await fetch('/api/auth/logout', {
                method: 'POST',
                headers: { 'Authorization': 'Bearer ' + token }
              });
            } catch (err) {
              console.error(err);
            }
          }
          localStorage.removeItem('accessToken');
          localStorage.removeItem('user');
          document.cookie = "token=; path=/; max-age=0; expires=Thu, 01 Jan 1970 00:00:00 GMT";
          window.location.href = '/api'; // redirige a landing page
        });

            // 4. VERIFICACIÓN INICIAL DE NOTIFICACIONES (Ahora sí funcionará)
          try {
              // Usamos la variable 'token' que declaramos arriba
              const response = await fetch(`/api/notifications/${user._id}`, {
                  method: 'GET',
                  headers: {
                      'Authorization': 'Bearer ' + token 
                  }
              });

              if (response.ok) {
                  const notifications = await response.json();
                  // Si hay alguna sin leer (read: false), encendemos la luz
                  const hasUnread = notifications.some(n => !n.read);

                  // Ahora que el icono existe en el HTML, le ponemos el badge si hace falta
                  if (hasUnread) {
                      updateBellBadge(true);
                  }
              }
          } catch (err) {
            console.error("Error verificando notificaciones iniciales:", err);
          }
          //Socket
          // Configurar socket **después** de crear HTML
          const socket = io('/');
          socket.emit('join', user._id); 

          socket.on('newNotification', (notif) => { 
              console.log('Nueva notificación:', notif);

              // Animación visual de la campana
              const bell = document.getElementById('notifIcon');
              if (bell) {
                  bell.classList.add('blink');
                  setTimeout(() => bell.classList.remove('blink'), 2000);
                  
                  // MOSTRAR BADGE EN CAMPANA (Porque acaba de llegar una nueva)
                  updateBellBadge(true);
              }

              // Agregar a la lista dinámicamente
              const list = document.getElementById('notificationsList');
              if (list) {
                  // Aseguramos que venga como no leída desde el socket (usualmente sí, pero forzamos para UI)
                  notif.read = false; 
                  const li = createNotificationItem(notif);
                  list.prepend(li);
              }
          });

        //Modal notificaciones
          document.getElementById('notifIcon').addEventListener('click', async () => {
            const modal = document.getElementById("notificationsModal");
            const notificationsList = document.getElementById("notificationsList");
            
            // Mostrar modal primero (UX rápida)
            modal.style.display = "block";
            
            try {
                const token = localStorage.getItem("accessToken");
                const response = await fetch(`/api/notifications/${user._id}`, {
                    method: 'GET',
                    headers: { 'Authorization': 'Bearer ' + token }
                });  

                const notifications = await response.json();
                
                notificationsList.innerHTML = "";

                if (notifications.length) {
                    // Verificar si hay alguna no leída para mantener el badge de la campana
                    const hasUnread = notifications.some(n => !n.read);
                    updateBellBadge(hasUnread); 

                    notifications.forEach(n => {
                        const li = createNotificationItem(n);
                        notificationsList.appendChild(li);
                    });
                } else {
                    const li = document.createElement("li");
                    li.textContent = "No tienes notificaciones";
                    notificationsList.appendChild(li);
                    updateBellBadge(false); // No hay notificaciones, limpiar badge
                }

                // --- Cierre del modal ---
                const closeBtn = modal.querySelector(".close");
                closeBtn.onclick = () => modal.style.display = "none";
                window.onclick = (event) => {
                    if (event.target === modal) modal.style.display = "none";
                };

            } catch (err) {
                console.error(err);
            }
          });
      
    });

    //Buscador
        // Referencias
          const searchInput = document.getElementById('searchInput');
          const dateInput = document.getElementById('dateInput');
          const peopleInput = document.getElementById('peopleInput');
          const activityInput = document.getElementById('activityInput');
          const btnSearch = document.getElementById('btnSearch');

          // Función principal de búsqueda
          const performSearch = () => {
            const filters = {
                search: searchInput?.value.trim(),
                date: dateInput?.value,
                people: peopleInput?.value,
                activity: activityInput?.value
            };
            fetchExperiences(filters);
        };

          // Listeners: Buscar cuando el usuario interactúe
          // Debounce para el texto (esperar a que termine de escribir)
          let debounceTimer;
          if(searchInput) {
              searchInput.addEventListener('input', () => {
                  clearTimeout(debounceTimer);
                  debounceTimer = setTimeout(performSearch, 400); 
              });
          }

          // Búsqueda inmediata al cambiar fecha, actividad o personas
          if(dateInput) dateInput.addEventListener('change', performSearch);
          if(activityInput) activityInput.addEventListener('change', performSearch);
          if(peopleInput) peopleInput.addEventListener('change', performSearch);

          // Carga inicial (sin filtros)
          performSearch();

          // Referencia al botón
          const btnClear = document.getElementById('btnClear');

          // Listener para borrar
          if (btnClear) {
              btnClear.addEventListener('click', () => {
                  // 1. Resetear valores de los inputs
                  if(searchInput) searchInput.value = '';
                  if(dateInput) dateInput.value = '';
                  if(peopleInput) peopleInput.value = '';
                  if(activityInput) activityInput.value = ''; // Vuelve a la opción por defecto

                  // 2. Ejecutar la búsqueda de nuevo (sin filtros)
                  // Esto recargará todas las experiencias originales
                  if (typeof performSearch === 'function') {
                      performSearch();
                  }
              });
          }

    //Cargar experiencias
    async function fetchExperiences(filters = {}) {
          try {
            // 1. Construir los parámetros URL dinámicamente
            const params = new URLSearchParams();
            
            // Solo agregamos al URL lo que tenga valor
            if (filters.search) params.append('search', filters.search);
            if (filters.date) params.append('startDate', filters.date); // Coincide con backend
            if (filters.people) params.append('people', filters.people);
            if (filters.activity) params.append('activity', filters.activity);

            // 2. Fetch al backend
            const res = await fetch(`/api/experiences?${params.toString()}`);
            
            if (!res.ok) throw new Error('Error en la petición');

            const data = await res.json();
            const container = document.getElementById('experiencesContainer');
            container.innerHTML = ''; // Limpiar contenedor

            // 3. Manejo de "Sin Resultados"
            if (!data.length) {
              container.innerHTML = `
                <div style="text-align:center; width:100%; grid-column: 1 / -1; padding: 40px;">
                    <h3> No encontramos resultados</h3>
                    <p>Intenta cambiar las fechas o quitar algunos filtros.</p>
                </div>
              `;
              return;
            }

            // 4. Renderizar Tarjetas
            data.forEach(exp => {
              const card = document.createElement('div');
              card.className = 'experience-card';
              
              // Imagen por defecto si no hay
              const imageUrl = exp.photos && exp.photos.length > 0 ? exp.photos[0] : 'https://via.placeholder.com/280x180';
              
              // Formato de Fecha (ej: 25 Dic)
              const dateObj = new Date(exp.date);
              const dateStr = dateObj.toLocaleDateString('es-MX', { day: 'numeric', month: 'short' });

              // HTML estilo Airbnb
              card.innerHTML = `
                <div class="card-image-wrapper">
                    <img src="${imageUrl}" alt="${exp.title}">
                    <span class="card-badge">${exp.activity}</span>
                </div>
                <div class="content">
                  <div class="card-header">
                    <h3>${exp.title}</h3>
                  </div>
                  <p class="location">${exp.location}</p>
                  <p class="date">${dateStr}</p>
                  <div class="price-row">
                    <span class="price"><strong>$${exp.pricePerPerson}</strong> <small>${exp.currency}</small></span>
                    <span class="per-person">por persona</span>
                  </div>
                </div>
              `;

              

              card.addEventListener('click', () => {
                if(typeof openExperienceModal === 'function') openExperienceModal(exp._id);
              });
            

              container.appendChild(card);
            });
          } catch (err) {
            console.error("Error cargando experiencias:", err);
          }
        }







    // Lógica del Modal
    const modal = document.getElementById('guideModal');
    const closeModal = document.getElementById('closeModal');
    const cancelBtn = document.getElementById('cancelBtn');
    const submitGuideBtn = document.getElementById('submitGuideBtn');
    const languageInput = document.getElementById('languageInput');
    const addLanguageBtn = document.getElementById('addLanguageBtn');
    const languageTags = document.getElementById('languageTags');
    const specialtyInput = document.getElementById('specialtyInput');
    const addSpecialtyBtn = document.getElementById('addSpecialtyBtn');
    const specialtyTags = document.getElementById('specialtyTags');

    let languages = ['Español']; // Idioma por defecto
    let specialties = [];

    // Mostrar idioma por defecto
    updateLanguageTags();

    function updateLanguageTags() {
      languageTags.innerHTML = '';
      languages.forEach((lang, index) => {
        const tag = document.createElement('div');
        tag.className = 'language-tag';
        tag.innerHTML = `
          ${lang}
          <span class="remove-tag" data-index="${index}">&times;</span>
        `;
        languageTags.appendChild(tag);
      });

      // Event listeners para remover idiomas
      document.querySelectorAll('.language-tag .remove-tag').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const index = parseInt(e.target.getAttribute('data-index'));
          languages.splice(index, 1);
          updateLanguageTags();
        });
      });
    }

    function updateSpecialtyTags() {
      specialtyTags.innerHTML = '';
      specialties.forEach((spec, index) => {
        const tag = document.createElement('div');
        tag.className = 'specialty-tag';
        tag.innerHTML = `
          ${spec}
          <span class="remove-tag" data-index="${index}">&times;</span>
        `;
        specialtyTags.appendChild(tag);
      });

      // Event listeners para remover especialidades
      document.querySelectorAll('.specialty-tag .remove-tag').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const index = parseInt(e.target.getAttribute('data-index'));
          specialties.splice(index, 1);
          updateSpecialtyTags();
        });
      });
    }

    // Agregar idioma
    addLanguageBtn.addEventListener('click', () => {
      const lang = languageInput.value.trim();
      if (lang && !languages.includes(lang)) {
        languages.push(lang);
        updateLanguageTags();
        languageInput.value = '';
      }
    });

    // Agregar idioma con Enter
    languageInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        e.preventDefault();
        addLanguageBtn.click();
      }
    });

    // Agregar especialidad
    addSpecialtyBtn.addEventListener('click', () => {
      const spec = specialtyInput.value.trim();
      if (spec && !specialties.includes(spec)) {
        specialties.push(spec);
        updateSpecialtyTags();
        specialtyInput.value = '';
      }
    });

    // Agregar especialidad con Enter
    specialtyInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        e.preventDefault();
        addSpecialtyBtn.click();
      }
    });

    // Cerrar modal
    closeModal.addEventListener('click', () => {
      modal.style.display = 'none';
    });

    cancelBtn.addEventListener('click', () => {
      modal.style.display = 'none';
    });

    // Cerrar modal al hacer click fuera de él
    window.addEventListener('click', (e) => {
      if (e.target === modal) {
        modal.style.display = 'none';
      }
    });

    // Función para obtener un token válido (refrescar si es necesario)
    async function getValidToken() {
      let token = localStorage.getItem('accessToken');

      if (!token) {
        return null;
      }

      // Intentar usar el token actual primero
      return token;
    }

    // Función para refrescar el token si ha expirado
    async function refreshAccessToken() {
      const refreshToken = localStorage.getItem('refreshToken');

      if (!refreshToken) {
        console.error('No hay refresh token disponible');
        return null;
      }

      try {
        const res = await fetch('/api/auth/refresh', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ refreshToken })
        });

        if (res.ok) {
          const data = await res.json();
          localStorage.setItem('accessToken', data.data.accessToken);
          console.log('Token refrescado exitosamente');
          return data.data.accessToken;
        } else {
          console.error('Error al refrescar token');
          return null;
        }
      } catch (err) {
        console.error('Error en refresh token:', err);
        return null;
      }
    }

    // Enviar solicitud de guía
    submitGuideBtn.addEventListener('click', async () => {
      const bio = document.getElementById('guideBio').value.trim();
      const experienceYears = document.getElementById('guideExperienceYears').value;

      // Validaciones
      if (!bio) {
        alert('Por favor ingresa una biografía');
        return;
      }

      if (!experienceYears || experienceYears < 0) {
        alert('Por favor ingresa años de experiencia válidos');
        return;
      }

      if (languages.length === 0) {
        alert('Por favor agrega al menos un idioma');
        return;
      }

      let token = await getValidToken();
      console.log('Token encontrado:', token ? 'Sí' : 'No');

      if (!token) {
        alert('Debes iniciar sesión');
        return;
      }

      console.log('Enviando datos:', { bio, experienceYears: parseInt(experienceYears), languages, specialties });

      try {
        let res = await fetch('/api/auth/request-guide', {
          method: 'POST',
          headers: {
            'Authorization': 'Bearer ' + token,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            bio,
            experienceYears: parseInt(experienceYears),
            languages,
            specialties
          })
        });

        console.log('Status de respuesta:', res.status);

        // Si el token expiró, intentar refrescarlo y reintentar
        if (res.status === 401) {
          console.log('Token expirado, intentando refrescar...');
          const newToken = await refreshAccessToken();

          if (newToken) {
            // Reintentar con el nuevo token
            res = await fetch('/api/auth/request-guide', {
              method: 'POST',
              headers: {
                'Authorization': 'Bearer ' + newToken,
                'Content-Type': 'application/json'
              },
              body: JSON.stringify({
                bio,
                experienceYears: parseInt(experienceYears),
                languages,
                specialties
              })
            });
          } else {
            alert('Tu sesión ha expirado. Por favor inicia sesión nuevamente.');
            localStorage.clear();
            window.location.href = '/api/auth/login';
            return;
          }
        }

        if (res.ok) {
          const data = await res.json();
          console.log('Respuesta exitosa:', data);
          alert('¡Solicitud enviada exitosamente! Ahora eres guía.');

          // Actualizar usuario en localStorage
          const user = JSON.parse(localStorage.getItem('user'));
          user.roles = data.data.user.roles;
          localStorage.setItem('user', JSON.stringify(user));

          // Recargar página para actualizar navbar
          window.location.reload();
        } else {
          const error = await res.json();
          console.error('Error de servidor:', error);
          alert(error.message || 'Error al solicitar ser guía');
        }
      } catch (err) {
        console.error('Error en la petición:', err);
        alert('Error al procesar la solicitud: ' + err.message);
      }
    });


    //Buscador experiencias
    //document.getElementById('searchInput').addEventListener('input', (e) => {
        //fetchExperiences(e.target.value);
      //});

    // Abrir modal de detalle de experiencia
    async function openExperienceModal(experienceId) {
      try {
        const res = await fetch(`/api/experiences/${experienceId}`);
        const exp = await res.json();

        // Configurar imagen principal
        const mainImage = document.getElementById('modalMainImage');
        mainImage.src = exp.photos && exp.photos.length > 0 ? exp.photos[0] : 'https://via.placeholder.com/900x400';

        // Título
        document.getElementById('modalTitle').textContent = exp.title;

        // Badges
        const badgesContainer = document.getElementById('modalBadges');
        badgesContainer.innerHTML = `
          <span class="experience-badge badge-activity">${exp.activity}</span>
          <span class="experience-badge badge-difficulty">${exp.difficulty}</span>
          <span class="experience-badge badge-status">${exp.status === 'published' ? 'Publicado' : exp.status === 'draft' ? 'Borrador' : 'Archivado'}</span>
        `;

        // Grid de información
        const infoGrid = document.getElementById('modalInfoGrid');
        const dateFormatted = new Date(exp.date).toLocaleDateString('es-MX', {
          year: 'numeric',
          month: 'long',
          day: 'numeric'
        });

        infoGrid.innerHTML = `
          <div class="experience-info-item">
            <span class="experience-info-label">Ubicación</span>
            <span class="experience-info-value">📍 ${exp.location}</span>
          </div>
          <div class="experience-info-item">
            <span class="experience-info-label">Fecha</span>
            <span class="experience-info-value">📅 ${dateFormatted}</span>
          </div>
          <div class="experience-info-item">
            <span class="experience-info-label">Grupo</span>
            <span class="experience-info-value">👥 ${exp.minGroupSize || 1} - ${exp.maxGroupSize} personas</span>
          </div>
          <div class="experience-info-item">
            <span class="experience-info-label">Calificación</span>
            <span class="experience-info-value">⭐ ${exp.rating.toFixed(1)} / 5.0</span>
          </div>
        `;

        // Descripción
        document.getElementById('modalDescription').textContent = exp.description;

        // Galería de fotos (si hay más de 1)
        const photosContainer = document.getElementById('modalPhotosContainer');
        if (exp.photos && exp.photos.length > 1) {
          photosContainer.innerHTML = `
            <h3 style="color: #2c3e50; margin-bottom: 15px;">Galería de Fotos</h3>
            <div class="experience-photos-gallery">
              ${exp.photos.map(photo => `<img src="${photo}" alt="Foto de experiencia">`).join('')}
            </div>
          `;
        } else {
          photosContainer.innerHTML = '';
        }

        // Precio
        const priceFormatted = new Intl.NumberFormat('es-MX', {
          style: 'currency',
          currency: exp.currency || 'MXN'
        }).format(exp.pricePerPerson);

        document.getElementById('modalPrice').textContent = priceFormatted;

        // Botón de reservar
        const btnReserve = document.getElementById('btnReserve');
        btnReserve.onclick = () => {
          openReservationModal(exp);
        };

        // Mostrar modal
        // Cargar reviews del guía
        await loadGuideReviews(exp.guideId);

        document.getElementById('experienceDetailModal').style.display = 'block';
      } catch (err) {
        console.error('Error al cargar experiencia:', err);
        alert('Error al cargar los detalles de la experiencia');
      }
    }

    // Variables globales para la reserva
    let currentExperience = null;
    let selectedSeats = 1;

    // Abrir modal de reserva
    function openReservationModal(experience) {
      // Verificar si el usuario está logueado
      const user = JSON.parse(localStorage.getItem('user') || 'null');

      if (!user) {
        alert('Debes iniciar sesión para hacer una reserva');
        window.location.href = '/api/auth/login';
        return;
      }

      // Verificar que la experiencia esté publicada
      if (experience.status !== 'published') {
        const alertDiv = document.getElementById('reservationAlert');
        alertDiv.textContent = 'Esta experiencia no está disponible para reservar en este momento.';
        alertDiv.style.display = 'block';
        return;
      }

      // Verificar que la fecha no haya pasado
      const experienceDate = new Date(experience.date);
      const today = new Date();
      today.setHours(0, 0, 0, 0);

      if (experienceDate < today) {
        alert('Esta experiencia ya ha pasado y no está disponible para reservar.');
        return;
      }

      currentExperience = experience;
      selectedSeats = 1;

      // Llenar información de la experiencia
      document.getElementById('reservationExpTitle').textContent = experience.title;

      const dateFormatted = new Date(experience.date).toLocaleDateString('es-MX', {
        year: 'numeric',
        month: 'long',
        day: 'numeric'
      });
      document.getElementById('reservationExpDate').textContent = dateFormatted;
      document.getElementById('reservationExpLocation').textContent = experience.location;

      const priceFormatted = new Intl.NumberFormat('es-MX', {
        style: 'currency',
        currency: experience.currency || 'MXN'
      }).format(experience.pricePerPerson);
      document.getElementById('reservationPricePerPerson').textContent = priceFormatted;

      // Configurar selector de asientos
      document.getElementById('seatsDisplay').textContent = selectedSeats;
      document.getElementById('seatsAvailableLabel').textContent =
        `Disponibles: ${experience.minGroupSize || 1} - ${experience.maxGroupSize} personas`;

      // Calcular y mostrar total
      updateReservationTotal();

      // Ocultar alerta
      document.getElementById('reservationAlert').style.display = 'none';

      // Cerrar modal de experiencia y abrir modal de reserva
      document.getElementById('experienceDetailModal').style.display = 'none';
      document.getElementById('reservationModal').style.display = 'block';
    }

    // Actualizar total de la reserva
    function updateReservationTotal() {
      if (!currentExperience) return;

      const total = currentExperience.pricePerPerson * selectedSeats;
      const totalFormatted = new Intl.NumberFormat('es-MX', {
        style: 'currency',
        currency: currentExperience.currency || 'MXN'
      }).format(total);

      document.getElementById('reservationTotal').textContent = totalFormatted;

      // Actualizar estado de botones
      const decreaseBtn = document.getElementById('decreaseSeats');
      const increaseBtn = document.getElementById('increaseSeats');

      decreaseBtn.disabled = selectedSeats <= 1;
      increaseBtn.disabled = selectedSeats >= currentExperience.maxGroupSize;
    }

    // Decrementar asientos
    document.getElementById('decreaseSeats').addEventListener('click', () => {
      if (selectedSeats > 1) {
        selectedSeats--;
        document.getElementById('seatsDisplay').textContent = selectedSeats;
        updateReservationTotal();
      }
    });

    // Incrementar asientos
    document.getElementById('increaseSeats').addEventListener('click', () => {
      if (currentExperience && selectedSeats < currentExperience.maxGroupSize) {
        selectedSeats++;
        document.getElementById('seatsDisplay').textContent = selectedSeats;
        updateReservationTotal();
      }
    });

    // Cerrar modal de reserva
    document.getElementById('closeReservationModal').addEventListener('click', () => {
      document.getElementById('reservationModal').style.display = 'none';
    });

    document.getElementById('btnCancelReservation').addEventListener('click', () => {
      document.getElementById('reservationModal').style.display = 'none';
    });

    // Confirmar reserva
    document.getElementById('btnConfirmReservation').addEventListener('click', async () => {
      if (!currentExperience) return;

      const user = JSON.parse(localStorage.getItem('user') || 'null');
      if (!user) {
        alert('Debes iniciar sesión para hacer una reserva');
        window.location.href = '/api/auth/login';
        return;
      }

      // Validar número de asientos
      if (selectedSeats < (currentExperience.minGroupSize || 1)) {
        alert(`El número mínimo de personas es ${currentExperience.minGroupSize || 1}`);
        return;
      }

      if (selectedSeats > currentExperience.maxGroupSize) {
        alert(`El número máximo de personas es ${currentExperience.maxGroupSize}`);
        return;
      }

      const total = currentExperience.pricePerPerson * selectedSeats;

      const reservationData = {
        experienceId: currentExperience._id,
        userId: user._id,
        seats: selectedSeats,
        total: total,
        status: 'pending'
      };

      try {
        let token = localStorage.getItem('accessToken');

        let res = await fetch('/api/reservations', {
          method: 'POST',
          headers: {
            'Authorization': 'Bearer ' + token,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(reservationData)
        });

        // Si el token expiró, intentar refrescarlo
        if (res.status === 401) {
          const newToken = await refreshAccessToken();

          if (newToken) {
            res = await fetch('/api/reservations', {
              method: 'POST',
              headers: {
                'Authorization': 'Bearer ' + newToken,
                'Content-Type': 'application/json'
              },
              body: JSON.stringify(reservationData)
            });
          } else {
            alert('Tu sesión ha expirado. Por favor inicia sesión nuevamente.');
            localStorage.clear();
            window.location.href = '/api/auth/login';
            return;
          }
        }

        if (res.ok) {
          const data = await res.json();
          alert('¡Reserva confirmada exitosamente! Nos pondremos en contacto contigo pronto.');
          document.getElementById('reservationModal').style.display = 'none';
          currentExperience = null;
          selectedSeats = 1;
        } else {
          const error = await res.json();
          alert(error.error || 'Error al crear la reserva');
        }
      } catch (err) {
        console.error('Error al crear reserva:', err);
        alert('Error al procesar la reserva. Por favor intenta de nuevo.');
      }
    });

    // Cerrar modal de experiencia
    document.getElementById('closeExperienceModal').addEventListener('click', () => {
      document.getElementById('experienceDetailModal').style.display = 'none';
    });

    // Cerrar al hacer click fuera de los modales
    window.addEventListener('click', (e) => {
      const experienceModal = document.getElementById('experienceDetailModal');
      const reservationModal = document.getElementById('reservationModal');

      if (e.target === experienceModal) {
        experienceModal.style.display = 'none';
      }

      if (e.target === reservationModal) {
        reservationModal.style.display = 'none';
      }
    });


    // Función para cargar reviews del guía
    async function loadGuideReviews(guideId) {
      const reviewsContainer = document.getElementById('reviewsContainer');
      reviewsContainer.innerHTML = '<div class="reviews-loading">Cargando reseñas...</div>';

      try {
        const res = await fetch(`/api/reviews?guideId=${guideId}`);
        if (!res.ok) {
          throw new Error('Error al cargar reviews');
        }

        const reviews = await res.json();

        if (reviews.length > 0) {
          const avgRating = reviews.reduce((sum, r) => sum + (r.guideRating || 0), 0) / reviews.length;

          document.getElementById('guideAvgRating').textContent = avgRating.toFixed(1);
          document.getElementById('guideReviewCount').textContent = `${reviews.length} reseña${reviews.length !== 1 ? 's' : ''}`;

          const starsContainer = document.getElementById('guideRatingStars');
          starsContainer.innerHTML = '';
          for (let i = 1; i <= 5; i++) {
            const star = document.createElement('span');
            star.className = i <= Math.round(avgRating) ? 'star-filled' : 'star-empty';
            star.textContent = '★';
            starsContainer.appendChild(star);
          }

          renderReviews(reviews);
        } else {
          reviewsContainer.innerHTML = '<div class="no-reviews">Este guía aún no tiene reseñas</div>';
          document.getElementById('guideAvgRating').textContent = '-';
          document.getElementById('guideReviewCount').textContent = 'Sin calificaciones';
          document.getElementById('guideRatingStars').innerHTML = '';
        }
      } catch (err) {
        console.error('Error al cargar reviews:', err);
        reviewsContainer.innerHTML = '<div class="no-reviews">Error al cargar reseñas</div>';
      }
    }

    function renderReviews(reviews) {
      const container = document.getElementById('reviewsContainer');

      if (reviews.length === 0) {
        container.innerHTML = '<div class="no-reviews">Este guía aún no tiene reseñas</div>';
        return;
      }

      const reviewsList = document.createElement('div');
      reviewsList.className = 'reviews-list';

      reviews.forEach(review => {
        const reviewCard = document.createElement('div');
        reviewCard.className = 'review-card';

        const reviewDate = new Date(review.createdAt).toLocaleDateString('es-MX', {
          year: 'numeric',
          month: 'long',
          day: 'numeric'
        });

        const expStars = generateStars(review.experienceRating || 0);
        const guideStars = generateStars(review.guideRating || 0);
        const userName = review.userId?.name || 'Usuario';

        reviewCard.innerHTML = `
              <div class="review-header">
                <div class="review-user-info">
                  <div class="review-user-name">${userName}</div>
                  <div class="review-date">${reviewDate}</div>
                </div>
                <div class="review-ratings">
                  <div class="review-rating-item">
                    <span>Experiencia:</span>
                    <div class="review-stars">${expStars}</div>
                  </div>
                  <div class="review-rating-item">
                    <span>Guía:</span>
                    <div class="review-stars">${guideStars}</div>
                  </div>
                </div>
              </div>
              <div class="review-comment">${review.comment || 'Sin comentario'}</div>
              ${review.photos && review.photos.length > 0 ? `
                <div class="review-photos">
                  ${review.photos.map(photo => `<img src="${photo}" alt="Foto de reseña" class="review-photo">`).join('')}
                </div>
              ` : ''}
            `;

        reviewsList.appendChild(reviewCard);
      });

      container.innerHTML = '';
      container.appendChild(reviewsList);
    }

    function generateStars(rating) {
      let stars = '';
      for (let i = 1; i <= 5; i++) {
        stars += `<span class="${i <= rating ? 'star-filled' : 'star-empty'}">★</span>`;
      }
      return stars;
    }

  </script>
</body>

</html>